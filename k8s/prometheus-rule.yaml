# alert manager와 연결되는 설정
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: my-app-alerts
  namespace: default
  labels:
    release: monitoring               # 중앙 Prometheus ruleSelector와 일치
    app.kubernetes.io/instance: monitoring
spec:
  groups:
  - name: my-app.rules
    rules:
    - alert: MyAppHigh5xxErrorRate
      expr: |
        sum(rate(http_requests_total{service="my-app",status=~"5.."}[5m]))
        /
        sum(rate(http_requests_total{service="my-app"}[5m]))
        > 0.05
      for: 5m
      labels:
        severity: critical
        service: my-app
        team: platform
      annotations:
        summary: "my-app 5xx ratio > 5%"
        description: "Sustained 5xx errors for 5m. Check logs and downstream dependencies."
